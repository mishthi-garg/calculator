<!DOCTYPE html>
<html>

<head>
  <title>
    Calculator
  </title>
  <link rel="stylesheet" href="calculator.css">
</head>

<body>
  <p class="js-expression"></p>
  <div class="calculator-buttons">

    <button class="numbers" onclick="
      updateCalculation('1');
      "> 1 </button>
    <button class="numbers" onclick="
      updateCalculation('2');
      "> 2 </button>
    <button class="numbers" onclick="
      updateCalculation('3');
      "> 3 </button>

    <button class="operation" onclick="
      updateCalculation('/');
      "> / </button>

    <button class="numbers" onclick="
      updateCalculation('4');
      "> 4 </button>
    <button class="numbers" onclick="
      updateCalculation('5');
      "> 5 </button>
    <button class="numbers" onclick="
      updateCalculation('6');
      "> 6 </button>

    <button class="operation" onclick="
      updateCalculation('*');
      "> * </button>
    <button class="numbers" onclick="
      updateCalculation('7');
      "> 7 </button>
    <button class="numbers" onclick="
      updateCalculation('8');
      "> 8 </button>
    <button class="numbers" onclick="
      updateCalculation('9');
      "> 9 </button>

    <button class="operation" onclick="
      updateCalculation('-');
      "> - </button>
      <button class="numbers" onclick="
      updateCalculation('.');
      "> . </button>
    <button class="numbers" onclick="
      updateCalculation('0');
      "> 0 </button>

    <button class="operation" onclick="
      updateCalculation('+');
      "> + </button>

    <button class="equals" onclick="
      updateCalculation('=');
      "> = </button>
      <button class="clear" onclick="
      updateCalculation('C');
      "> Clear </button>
      <button class="clear" onclick="
      updateCalculation('del');
      "> Del </button>      
  </div>
  

  <script>
    let calculation=JSON.parse(localStorage.getItem('calculation')) || '0';
    let justEvaluated = true;
    let lastIsOperator = false;
    console.log(calculation);
    document.querySelector('.js-expression').innerHTML = `${calculation}`;

    function updateCalculation(entry){

      const operators = ['+','-','*','/'];
      if(entry === '='){
        if(lastIsOperator === true){
          alert('Invalid format used');
        }
        else{
        calculation= eval(calculation).toString();
        justEvaluated = true;
        lastIsOperator = false;
        }
      }
      else if(entry === 'C'){
        calculation = '0';
        justEvaluated = true;
        localStorage.removeItem('calculation');
        lastIsOperator = false;
      }
      else if(entry === 'del'){
        if (lastIsOperator === true) calculation = calculation.slice(0, -3);
        else calculation = calculation.slice(0, -1);
        justEvaluated = false;
        lastIsOperator = false;
      }      
      else{
        if(justEvaluated && !operators.includes(entry)){
          calculation = entry;
          justEvaluated = false;
          lastIsOperator = false;
        }
        else{
          if(operators.includes(entry)){
            if(lastIsOperator === true){
              calculation = calculation.slice(0, -3);
              lastIsOperator = true;
            }
            calculation+= ' '+entry+' ';  
            lastIsOperator = true;
          }
          else{
            calculation += entry;
            
            lastIsOperator = false;
          }
          justEvaluated = false;
        }
        
      }
      localStorage.setItem('calculation',JSON.stringify(calculation));

      console.log(calculation);
      document.querySelector('.js-expression').innerHTML = `${calculation}`;
    }
  </script>
</body>

</html>